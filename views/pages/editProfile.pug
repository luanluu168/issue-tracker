extends layout.pug
    
block content
    //- Intro
    div(class='container-fluid my-3 mx-1 p-3')
        if user
            .card
                .card-body
                    form(action='/image/server/change-user-image' method='POST' enctype="multipart/form-data" oninput='confirmNewPasword.setCustomValidity(newPassword.value != confirmNewPasword.value ? "Passwords do not match." : "")')
                        .row
                            .col-12.col-sm-auto.mb-3
                                .mx-auto(style='width: 150px;')
                                    .d-flex.justify-content-center.align-items-center.rounded(style='height: 150px; background-color: rgb(233, 236, 239);')
                                        if user && user.image
                                            img(src=`${user.image}` alt='photo' width='150' height='150')
                                        else 
                                            span(style='color: rgb(166, 168, 170); font: bold 8pt Arial;') 150x150 
                            .col.d-flex.flex-column.flex-sm-row.justify-content-between.mb-3
                                .text-center.text-sm-left.mb-2.mb-sm-0
                                    h4.pt-sm-2.pb-1.mb-0.text-nowrap #{user.name}
                                    p.mb-0 #{user.email}
                                    .text-muted
                                        small Last seen #{user.lastLogin || '2 hours ago'}
                                    .mt-0
                                        .custom-file
                                            input#input-user-image-file.custom-file-input(type='file' name='userAvatar')
                                            label(for='input-user-image-file' class='btn btn-primary') 
                                                i.fa.fa-fw.fa-camera
                                                span(class='ml-1') Change Image

                                        //- button.btn.btn-primary(type='button' name='changeImageButton' data-toggle='modal' data-target='#changeImageModal')
                                        //-     i.fa.fa-fw.fa-camera
                                        //-     span(class='ml-1') Change Photo
                                        //- input#input-user-image-file-1(name='userAvatar' type='text' class='custom-file-input')
                                .text-center.text-sm-right
                                    span.badge.badge-secondary #{user.role}
                                    .text-muted
                                        small Joined #{user.createdOn}
                        ul.nav.nav-tabs
                            li.nav-item
                                a.active.nav-link(href='') Settings
                        .tab-content.pt-3
                            .tab-pane.active
                                form.form(novalidate='')
                                    .row
                                        .col
                                            .row
                                                .col
                                                    .form-group
                                                        label User name
                                                        input.form-control(type='text' name='userName' value=user.name)
                                                .col
                                                    .form-group
                                                        label Email
                                                        input.form-control(type='email' value=user.email readonly)
                                    .row
                                        .col-12.col-sm-6.mb-3
                                            .mb-2
                                                b Change Password
                                            .row
                                                .col
                                                    .form-group
                                                        label Current Password
                                                        input.form-control(type='password' value=user.password readonly)
                                            .row
                                                .col
                                                    .form-group
                                                        label New Password (only available for account using non-social signup)
                                                        input.form-control(type='password' name='newPassword' class='form-control text-truncate' 
                                                                pattern='^(?=.*[A-Za-z])(?=.*\\d)(?=.*[$@$!%*#?&])[A-Za-z\\d$@$!%*#?&]{6,}$'
                                                                placeholder='Please enter your new password' onchange="try{setCustomValidity('')}catch(e){}" 
                                                                oninvalid="this.setCustomValidity('Need min 6 chars: At least 1 letter, 1 number, and 1 special char')" 
                                                                oninput="this.setCustomValidity(' ')" aria-expanded="true" 
                                                                disabled=user.isSocialAccount)
                                            .row
                                                .col
                                                    .form-group
                                                        label
                                                            | Confirm 
                                                            span.d-none.d-xl-inline Password
                                                        input.form-control(type='password' name='confirmNewPasword' 
                                                                            disabled=user.isSocialAccount)
                                        .col-12.col-sm-5.mb-3
                                            .mb-2
                                                b Keeping in Touch
                                            .row
                                                .col
                                                    label Email Notifications
                                                    .custom-controls-stacked.px-2
                                                        .custom-control.custom-checkbox
                                                            input#notifications-news.custom-control-input(type='checkbox' checked='')
                                                            label.custom-control-label(for='notifications-news') Newsletter
                                .row
                                    .col.d-flex.justify-content-end
                                        button.btn.btn-primary(type='submit') Save Changes

        else
            | Loading... (please refresh if waiting too long)

        form(enctype="multipart/form-data")
            #changeImageModal.modal.fade(tabindex='-1' role='dialog' aria-labelledby='changeImageModalLabel' aria-hidden='true')
                .modal-dialog.modal-lg(role='document')
                    .modal-content
                        .modal-header
                            h4#changeImageModalLabel.modal-title Change Photo
                            button.close(type='button' data-dismiss='modal' aria-label='Close' class='btn-outline-danger')
                                span(aria-hidden='true') &times;
                        .modal-body
                            .file-loading
                                input#input-user-image-file-2(name='tmpUserAvatar' type='file' accept='.jpg,.png')
                        .modal-footer
                            button.btn.btn-secondary(type='button' data-dismiss='modal') Close
                            button.btn.btn-primary(id='changeImageModalSaveButton' type='submit' title='Save image') Save
